<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEXA Stat Pro Advisor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; color: #333; margin: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 25px; }
        h1 { color: #2c3e50; margin-bottom: 5px; }
        .author-link { font-size: 0.9rem; color: #0088cc; text-decoration: none; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .author-link:hover { text-decoration: underline; }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; padding: 15px; background: #fafafa; border-radius: 8px; }
        .input-group { display: flex; flex-direction: column; }
        label { font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: #555; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
        button { grid-column: 1 / -1; padding: 12px; background-color: #2e86c1; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: background 0.3s; }
        button:hover { background-color: #21618c; }
        #resultsBox { margin-top: 20px; padding: 15px; border-radius: 8px; border-left: 5px solid #2e86c1; background: #eef6fb; display: none; }
        .advice-keep { border-left-color: #27ae60 !important; background: #ebf9f1 !important; }
        .advice-reset { border-left-color: #d35400 !important; background: #fdf2e9 !important; }
        canvas { margin-top: 20px; max-height: 500px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>HEXA Stat Pro Advisor</h1>
        <a href="https://t.me/Hirafuu" class="author-link" target="_blank">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.13-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg>
            Contact Author: @Hirafuu
        </a>
    </div>

    <div class="input-grid">
        <div class="input-group"><label>Current Main</label><input type="number" id="cMain" value="5" min="0" max="10"></div>
        <div class="input-group"><label>Current Sub 1</label><input type="number" id="cSub1" value="4" min="0" max="10"></div>
        <div class="input-group"><label>Current Sub 2</label><input type="number" id="cSub2" value="2" min="0" max="10"></div>
        <div class="input-group"><label>Target Main (≥)</label><input type="number" id="tMain" value="7"></div>
        <div class="input-group"><label>Target Sub (≥)</label><input type="number" id="tSub" value="0"></div>
        <div class="input-group"><label>Meso/Frag (B)</label><input type="number" id="fragPrice" value="0.25" step="0.01"></div>
        <button onclick="runSimulation()">Run Advisor Simulation</button>
    </div>

    <div id="resultsBox">
        <strong id="adviceText" style="font-size: 1.2rem;"></strong><br>
        <span id="statsDetails"></span>
    </div>

    <canvas id="distributionChart"></canvas>
</div>

<script>
    let chartInstance = null;

    function get_main_rate(lvl) {
        if (lvl >= 10) return 0.0;
        const rates = {0: 0.35, 1: 0.35, 2: 0.20, 3: 0.20, 4: 0.20, 5: 0.20, 6: 0.15, 7: 0.10, 8: 0.05, 9: 0.05};
        return rates[lvl] || 0.0;
    }

    function get_cost(lvl) {
        if (lvl < 2) return 10;
        if (lvl < 6) return 20;
        if (lvl == 6) return 30;
        if (lvl == 7) return 40;
        return 50;
    }

    function simulate_remaining(m, s1, s2) {
        let cur_m = m, cur_s1 = s1, cur_s2 = s2;
        let frags = 0;
        let used = cur_m + cur_s1 + cur_s2;

        for (let i = 0; i < (20 - used); i++) {
            frags += get_cost(cur_m);
            let m_rate = get_main_rate(cur_m);
            let s1_rate = cur_s1 < 10 ? 0.325 : 0.0;
            let s2_rate = cur_s2 < 10 ? 0.325 : 0.0;
            let total_w = m_rate + s1_rate + s2_rate;

            if (total_w <= 0) break;

            let roll = Math.random() * total_w;
            if (roll < m_rate) cur_m++;
            else if (roll < m_rate + s1_rate) cur_s1++;
            else cur_s2++;
        }
        return [cur_m, cur_s1, cur_s2, frags];
    }

    function runSimulation() {
        const cM = parseInt(document.getElementById('cMain').value) || 0;
        const cS1 = parseInt(document.getElementById('cSub1').value) || 0;
        const cS2 = parseInt(document.getElementById('cSub2').value) || 0;
        const tM = parseInt(document.getElementById('tMain').value) || 0;
        const tS = parseInt(document.getElementById('tSub').value) || 0;
        const price = parseFloat(document.getElementById('fragPrice').value) || 0;

        const trials = 500000;
        let currentResults = [];
        let baselineResults = [];
        let curSuccess = 0, baseSuccess = 0;

        for (let i = 0; i < trials; i++) {
            let res = simulate_remaining(cM, cS1, cS2);
            currentResults.push(res);
            if ((tM > 0 && res[0] >= tM) || (tS > 0 && (res[1] >= tS || res[2] >= tS))) curSuccess++;

            let base = simulate_remaining(0, 0, 0);
            baselineResults.push(base);
            if ((tM > 0 && base[0] >= tM) || (tS > 0 && (base[1] >= tS || base[2] >= tS))) baseSuccess++;
        }

        const pCur = curSuccess / trials;
        const pBase = baseSuccess / trials;
        const avgFresh = (baselineResults.reduce((a, b) => a + b[3], 0) / trials) + 10;
        const expBase = avgFresh / pBase;
        const avgRem = currentResults.reduce((a, b) => a + b[3], 0) / trials;
        const expCur = avgRem + ((1 - pCur) / pCur) * expBase;

        const box = document.getElementById('resultsBox');
        box.style.display = "block";

        if (pCur >= pBase) {
            document.getElementById('adviceText').innerText = "ADVICE: KEEP PRESSING";
            box.className = "advice-keep";
        } else {
            document.getElementById('adviceText').innerText = "ADVICE: RESET NOW";
            box.className = "advice-reset";
        }

        document.getElementById('statsDetails').innerHTML = `
            Current Win Rate: <b>${(pCur * 100).toFixed(2)}%</b> (Baseline: ${(pBase * 100).toFixed(2)}%)<br>
            Exp. Total Cost: <b>${expCur.toFixed(1)} Frags</b> (~${(expCur * price).toFixed(2)}B Mesos)
        `;

        updateChart(currentResults, trials);
    }

    function updateChart(data, trials) {
        const ctx = document.getElementById('distributionChart').getContext('2d');
        const mainC = new Array(11).fill(0), subC = new Array(11).fill(0);

        data.forEach(r => { mainC[r[0]]++; subC[r[1]]++; subC[r[2]]++; });

        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                datasets: [{
                    label: 'Main Stat (%)', data: mainC.map(c => (c / trials) * 100),
                    borderColor: '#2e86c1', backgroundColor: 'rgba(46, 134, 193, 0.1)', fill: true, tension: 0.4, borderWidth: 3
                }, {
                    label: 'Sub Stats Avg (%)', data: subC.map(c => (c / (trials * 2)) * 100),
                    borderColor: '#d35400', borderDash: [5, 5], tension: 0.4, borderWidth: 1.5, pointRadius: 2, alpha: 0.3
                }]
            },
            options: {
                responsive: true,
                plugins: { title: { display: true, text: 'Final Level Distribution Probability' } },
                scales: { y: { beginAtZero: true, title: { display: true, text: 'Probability (%)' } } }
            }
        });
    }
</script>
</body>
</html>